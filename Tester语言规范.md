# Tester 语言规范文档

## 概述

Tester 语言是一种专门用于 CAN 总线测试的脚本语言，支持 CAN 设备初始化、消息发送接收、延时控制等功能。该语言设计简洁，语法清晰，适合自动化测试场景。

## 文件扩展名

- `.tst` - Tester 脚本文件

## 语法结构

### 1. 注释

#### 行注释

```tester
// 这是行注释
tcaninit 70,0,0,500//车身网CAN
```

#### 块注释

```tester
----------这是注释----------
----------CAN设备初始化----------
```

### 2. 设备初始化块

#### 语法结构

```tester
tset
tcaninit 设备ID,设备索引,通道索引,仲裁波特率[,数据域波特率]
tend
```

#### 参数说明

- **设备 ID**: 设备标识符（数字）
- **设备索引**: 设备索引号（数字）
- **通道索引**: CAN 通道号（数字）
- **仲裁波特率**: 仲裁域波特率（数字）
- **数据域波特率**: 数据域波特率（可选，用于 CANFD）

#### 示例

```tester
tset
tcaninit 70,0,0,500//车身网CAN
tcaninit 70,0,1,500,2000//智能进入网CANFD
tend
```

### 3. 测试用例结构

#### 基本语法

```tester
ttitle=测试用例一级标题
用例编号 tstart=用例描述(测试用例二级标题)
  // 测试命令
tend
ttitle-end
```

#### 语法块

```配置信息
tset
  // 配置信息
tend
```

```用例集
ttitle=字符串
  // 具体测试用例
ttitle-end
```

```测试用例
序号 tstart=字符串
  // 测试命令
tend
```

#### 参数说明

- **ttitle**: 测试模板标题
- **用例编号**: 数字编号
- **tstart**: 用例描述
- **ttitle-end**: 结束当前测试模板

#### 示例

```tester
ttitle=模板示例1
1 tstart=用例描述
  tcans 121,12 02 00 00 00 00 00 00,100,1
  tcans 12d,00 00 00 0c 00 00 00 00,100,1
  tdelay 1000
  tcanr 121,1.0-2.3,530,1000
  tcanr 121,0.0-7.7,print
tend
ttitle-end
```

### 4. 命令详解

#### 4.1 CAN 发送命令 (tcans)

**语法**: `tcans CAN_ID,数据字节,发送间隔,发送次数`

**参数**:

- **CAN_ID**: CAN 消息 ID（十六进制或十进制）
- **数据字节**: 8 字节十六进制数据，空格分隔
- **发送间隔**: 发送间隔时间（毫秒）
- **发送次数**: 发送次数

**示例**:

```tester
tcans 121,12 02 00 00 00 00 00 00,100,1
tcans 12d,00 00 00 0c 00 00 00 00,100,1
```

#### 4.2 CAN 接收命令 (tcanr)

**语法**: `tcanr CAN_ID,数值范围,超时时间,等待时间`

**参数**:

- **CAN_ID**: 要接收的 CAN 消息 ID
- **数值范围**: 期望的数值范围（格式：最小值-最大值）
- **期待的值**: 期待值
- **等待时间**: 等待时间（毫秒）

**示例**:

```tester
tcanr 121,1.0-2.3,530,1000
```

#### 4.2.1 CAN 打印输出命令 (tcanr print)

**语法**: `tcanr 报文ID,数据开始位-数据结束位,print`

**参数**:

- **报文 ID**: CAN 消息 ID
- **数据开始位**: 数据起始位置（格式：字节.位，如 0.0 表示第 0 字节第 0 位）
- **数据结束位**: 数据结束位置（格式：字节.位，如 7.7 表示第 7 字节第 7 位）
- **print**: 打印输出标识

**位格式说明**:

- 每个字节有 8 位（0-7）
- 格式：`字节号.位号`
- 例如：`0.0` 表示第 0 字节第 0 位，`1.7` 表示第 1 字节第 7 位

**示例**:

```tester
tcanr 121,0.0-7.7,print    // 打印完整8字节数据
tcanr 12d,0.0-3.7,print    // 打印前4字节数据
tcanr 123,2.0-5.7,print    // 打印第2-5字节数据
tcanr 124,1.4-2.3,print     // 打印第1字节第4位到第2字节第3位
```

#### 4.3 延时命令 (tdelay)

**语法**: `tdelay 延时时间`

**参数**:

- **延时时间**: 延时时间（毫秒）

**示例**:

```tester
tdelay 1000
```

#### 4.4 设备初始化命令 (tcaninit)

**语法**: `tcaninit 设备ID,设备索引,通道索引,仲裁波特率[,数据域波特率]`

**参数**:

- **设备 ID**: 设备标识符
- **设备索引**: 设备索引号
- **通道索引**: CAN 通道号
- **仲裁波特率**: 仲裁域波特率
- **数据域波特率**: 数据域波特率（可选，用于 CANFD）

**示例**:

```tester
tcaninit 70,0,0,500
tcaninit 70,0,1,500,2000
```

## 数据类型

### 1. 数字

- **整数**: `121`, `100`, `1000`
- **浮点数**: `1.0`, `2.3`
- **十六进制**: `12`, `02`, `00` (两位十六进制数)

### 2. 字符串

- **用例描述**: `用例描述`
- **模板标题**: `模板示例1`

### 3. 范围值

- **数值范围**: `1.0-2.3` (最小值-最大值格式)

## 语法高亮支持

### 关键字高亮

- **控制关键字**: `tset`, `tend`, `tstart`, `ttitle`, `ttitle-end`
- **命令关键字**: `tcans`, `tcanr`, `tdelay`, `tcaninit`

### 语法元素高亮

- **注释**: 行注释和块注释
- **数字**: 整数和浮点数
- **十六进制**: 两位十六进制数
- **字符串**: 用例描述和标题
- **范围值**: 数值范围格式

## 完整示例

```tester
----------这是注释----------
----------CAN设备初始化----------
----------tcaninit 设备ID,设备索引,通道索引,仲裁波特率[,数据域波特率]----------
tset

tcaninit 70,0,0,500//车身网CAN
tcaninit 70,0,1,500,2000//智能进入网CANFD

tend

ttitle=模板示例1
1 tstart=用例描述
  tcans 121,12 02 00 00 00 00 00 00,100,1
  tcans 12d,00 00 00 0c 00 00 00 00,100,1
  tdelay 1000
  tcanr 121,1.0-2.3,530,1000
  tcanr 121,0.0-7.7,print
tend

2 tstart=用例描述2
  tcans 121,12 02 00 00 00 00 00 00,100,1
  tcans 12d,00 00 00 0c 00 00 00 00,100,1
  tdelay 1000
  tcanr 121,1.0-2.3,530,1000
  tcanr 12d,0.0-3.7,print
tend

ttitle-end

ttitle=模板示例2
3 tstart=用例描述3
  tcans 121,12 02 00 00 00 00 00 00,100,1
  tcans 12d,00 00 00 0c 00 00 00 00,100,1
  tdelay 1000
  tcanr 121,1.0-2.3,530,1000
  tcanr 121,0.0-7.7,print
tend

ttitle-end
```

## 语法规则总结

1. **文件结构**: 由设备初始化块和测试用例组成
2. **注释支持**: 支持行注释(`//`)和块注释(`----------`)
3. **块结构**: 使用`tset`/`tend`定义设备初始化块
4. **测试用例**: 使用`ttitle`/`ttitle-end`定义测试模板
5. **命令执行**: 在测试用例中使用各种命令进行测试
6. **数据类型**: 支持整数、浮点数、十六进制、字符串和范围值

## VS Code 扩展支持

该语言已配置 VS Code 语法高亮扩展，支持：

- 关键字高亮
- 注释高亮
- 数字和十六进制高亮
- 字符串高亮
- 块结构高亮

文件扩展名：`.tst`
语言标识符：`tester`
